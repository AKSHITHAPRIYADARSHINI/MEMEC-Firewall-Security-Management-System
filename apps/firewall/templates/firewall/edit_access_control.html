{% extends "layouts/base.html" %}

{% block title %}Edit IP Access Control{% endblock %}

{% set page_title = "Edit IP Access Control" %}
{% set breadcrumbs = [
  {"title": "Administration", "url": None},
  {"title": "Firewall Management", "url": url_for('firewall_blueprint.dashboard')},
  {"title": "Access Control", "url": url_for('firewall_blueprint.access_control')},
  {"title": "Edit IP", "url": None}
] %}

{% block content %}
<div class="container-fluid py-4">
  <div class="row">
    <div class="col-md-8 mx-auto">
      <div class="card">
        <div class="card-header pb-0">
          <h6>Edit IP Address: <code>{{ entry.ip_address }}</code></h6>
          <p class="text-sm text-secondary">Modify IP access control entry</p>
        </div>
        <div class="card-body">
          <!-- Alerts -->
          {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
              {% for category, message in messages %}
                <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                  {{ message }}
                  <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
              {% endfor %}
            {% endif %}
          {% endwith %}

          <form method="post" action="{{ url_for('firewall_blueprint.edit_access_control', entry_id=entry.id) }}">
            {{ form.csrf_token }}

            <div class="mb-3">
              <label class="form-label">IP Address *</label>
              {{ form.ip_address(class="form-control") }}
              {% if form.ip_address.errors %}
                <div class="alert alert-danger mt-2">
                  {% for error in form.ip_address.errors %}
                    <small>{{ error }}</small><br>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <div class="mb-3">
              <label class="form-label">Device Identifier</label>
              {{ form.device_id(class="form-control", placeholder="Optional: device-name") }}
            </div>

            <div class="mb-3">
              <label class="form-label">Access Level *</label>
              {{ form.access_level(class="form-select") }}
              <small class="text-muted">
                <strong>Allow:</strong> Add to whitelist (trusted)<br>
                <strong>Block:</strong> Add to blacklist (untrusted)
              </small>
              {% if form.access_level.errors %}
                <div class="alert alert-danger mt-2">
                  {% for error in form.access_level.errors %}
                    <small>{{ error }}</small><br>
                  {% endfor %}
                </div>
              {% endif %}
            </div>

            <div class="mb-3">
              <label class="form-label">Notes</label>
              {{ form.notes(class="form-control", rows="3", placeholder="Optional: reason for allowing/blocking") }}
            </div>

            <div class="alert alert-info">
              <small>
                <strong>Added:</strong> {{ entry.added_at.strftime('%Y-%m-%d %H:%M:%S') }}<br>
                <strong>By:</strong> {{ entry.added_by_user.username if entry.added_by_user else 'Unknown' }}
              </small>
            </div>

            <div class="d-flex gap-2 pt-3 border-top">
              <button type="submit" name="submit" class="btn btn-primary">
                <i class="fas fa-save me-2"></i>Update IP Address
              </button>
              <a href="{{ url_for('firewall_blueprint.access_control') }}" class="btn btn-secondary">
                Cancel
              </a>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  code {
    background-color: #f5f5f5;
    padding: 4px 8px;
    border-radius: 3px;
    font-family: 'Monaco', monospace;
    font-size: 12px;
  }
</style>
{% endblock %}
